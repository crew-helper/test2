name: TEST push

# Controls when the action will run. Workflow runs when manually triggered using the UI
# or API.
on:
  push:


# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:

  test-push:
    runs-on: ubuntu-latest
    steps:

      - name: Check out code into the Go module directory
        uses: actions/checkout@v2
        with:
          fetch-depth: 0

    - name: Create all-in-one configuration
      uses: ./.github/actions/all-in-one
      with:
        IMAGE_URL: leori/atlas-ci:v4 #${{ secrets.DOCKER_REGISTRY }}/${{ secrets.DOCKER_REPO }}:${{ github.ref }}
        version: ${{ github.event.inputs.version }}

    - name: Create configuration package
      run: |
        set -x
        tar czvf ao-all-in-one-${{ github.event.inputs.version }}.tar.gz -C deploy .

    - name: Tag and push
      uses: ./.github/actions/auto-push
      with:
        version: ${{ github.event.inputs.version }}
